name: Local LLM Accuracy Evaluation

on:
    workflow_run:
        workflows: ["AI Policy Engine (Local LLM)"]
        types: [completed]

jobs:
    evaluate:
        runs-on: self-hosted

        steps:
            - uses: actions/checkout@v4

            - name: Download AI Output
              uses: actions/download-artifact@v4
              with:
                  name: ai-policy-output
                  path: ai/output

            - name: Safety Check
              run: |
                  for f in ai/output/*.json; do
                    bash scripts/ai-safety-check.sh "$f"
                  done

            - name: Accuracy Evaluation
              run: |
                  for f in ai/output/*.json; do
                    python3 scripts/evaluate-ai-output.py "$f"
                  done

            - name: Save Evaluation Result
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: ai-eval-result
                  path: ai/output
